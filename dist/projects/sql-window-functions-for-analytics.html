<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/svg+xml" href="/solivermazo/logo.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soliver Mazo</title>
    <script type="module" crossorigin="" src="/solivermazo/assets/app-fd13523a.js"></script>
    <link rel="stylesheet" href="/solivermazo/assets/index-441cc703.css">
  <link rel="modulepreload" crossorigin="" href="/solivermazo/assets/README-66a5f6de.js"><meta name="description" content="SQL Window Functions for Analytics — SQL, MySql Workbench, Data Analysis, Data Science"><meta property="og:description" content="SQL Window Functions for Analytics — SQL, MySql Workbench, Data Analysis, Data Science"><meta property="og:type" content="article"><meta property="og:url" content="https://solivervmazo.github.io/solivermazo/sql-window-functions-for-analytics"><meta property="og:title" content="Soliver Mazo"><meta property="og:image" content="https://solivervmazo.github.io/solivermazo/solivervmazo.png"><meta property="twitter:description" content="SQL Window Functions for Analytics — SQL, MySql Workbench, Data Analysis, Data Science"><meta property="twitter:card" content="summary_large_image"><meta property="url" content="https://solivervmazo.github.io/solivermazo/sql-window-functions-for-analytics"><meta property="twitter:title" content="Soliver Mazo"><meta property="twitter:image" content="https://solivervmazo.github.io/solivermazo/solivervmazo.png"></head>
  <body>
    <div id="app" data-server-rendered="true"><div class="light pt-0.5"><div class="flex flex-col dark:bg-primary-dark min-h-screen"><nav id="nav" class="fixed top-0 z-10 bg-gray-50 w-full x-0 mx-auto top-0 z-10 bg-primary-light dark:bg-primary-dark flex-none" data-v-27da57eb=""><div class="z-10 max-w-screen-lg mx-auto sm:flex justify-between sm:items-center my-3" data-v-27da57eb=""><div class="flex justify-between items-center px-4 sm:px-0" data-v-27da57eb=""><div data-v-27da57eb=""><a href="/solivermazo/" class="" data-v-27da57eb=""><img src="file:///D:/Personal/portfolio/vite-ssg/assets/images/logo-dark.png" class="w-36" alt="Dark Logo" data-v-27da57eb=""></a></div><div class="flex flex-items sm:hidden" data-v-27da57eb=""><a href="#" aria-label="Theme Switcher" class="sm:hidden bg-ternary-light dark:bg-ternary-dark hover:bg-hover-light dark:hover:bg-hover-dark hover:shadow-sm px-2.5 mx-1.5 py-2 rounded-lg" data-v-27da57eb=""><!----></a><button type="button" class="focus:outline-none" aria-label="Hamburger Menu" data-v-27da57eb=""><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-7 w-7 fill-current text-secondary-dark dark:text-ternary-light" data-v-27da57eb=""><!----><path fill-rule="evenodd" d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z" data-v-27da57eb=""></path></svg></button></div></div><div class="hidden m-0 sm:ml-4 mt-5 sm:mt-3 sm:flex p-5 sm:p-0 justify-center items-center shadow-lg sm:shadow-none" data-v-27da57eb=""><a href="/solivermazo/projects" class="font-general-medium block text-left text-lg font-medium text-primary-dark dark:text-ternary-light hover:text-indigo-600 dark:hover:text-indigo-300 sm:mx-4 mb-2 sm:py-2" aria-label="Projects">Projects</a><a href="/solivermazo/about" class="font-general-medium block text-left text-lg font-medium text-primary-dark dark:text-ternary-light hover:text-indigo-600 dark:hover:text-indigo-300 sm:mx-4 mb-2 sm:py-2 border-t-2 pt-3 sm:pt-2 sm:border-t-0 border-primary-light dark:border-secondary-dark" aria-label="About Me">About Me</a><a href="/solivermazo/contact" class="font-general-medium block text-left text-lg font-medium text-primary-dark dark:text-ternary-light hover:text-indigo-600 dark:hover:text-indigo-300 sm:mx-4 mb-2 sm:py-2 border-t-2 pt-3 sm:pt-2 sm:border-t-0 border-primary-light dark:border-secondary-dark" aria-label="Contact">Contact</a><a href="/solivermazo/credentials" class="font-general-medium block text-left text-lg font-medium text-primary-dark dark:text-ternary-light hover:text-indigo-600 dark:hover:text-indigo-300 sm:mx-4 mb-2 sm:py-2 border-t-2 pt-3 sm:pt-2 sm:border-t-0 border-primary-light dark:border-secondary-dark" aria-label="Credentials">Credentials</a></div><div class="hidden sm:flex justify-between items-center flex-col md:flex-row" data-v-27da57eb=""><a href="#" aria-label="Theme Switcher" class="ml-8 bg-primary-light dark:bg-ternary-dark px-3 py-2 shadow-sm rounded-xl cursor-pointer" data-v-27da57eb=""><!----></a></div></div></nav><div class="flex-grow pt-8"><div theme="light"><div class="container mx-auto mt-10 sm:mt-20" data-v-6bdc5779=""><div data-v-6bdc5779=""><p class="font-general-medium text-left text-3xl sm:text-4xl font-bold text-primary-dark dark:text-primary-light mt-14 sm:mt-20 mb-7">SQL Window Functions for Analytics</p><div class="flex"><div class="flex items-center mr-10"><!----><span class="font-general-medium ml-2 leading-none text-primary-dark dark:text-primary-light">Guided Project</span></div><!----><div class="flex items-center"><!----><span class="font-general-medium ml-2 leading-none text-primary-dark dark:text-primary-light">July 2023</span></div></div></div><div class="grid grid-cols-1 sm:grid-cols-3 sm:gap-10 mt-12" data-v-6bdc5779=""><!----><!--[--><div class="mb-10 sm:mb-0"><img src="file:///D:/Personal/portfolio/vite-ssg/.vite-ssg-temp/data/projects/sql_window_func/sql-window-functions-for-analytics-img-1.png" class="rounded-xl cursor-pointer shadow-lg sm:shadow-none" alt="sql_window_func/sql-window-functions-for-analytics-img-1.png"></div><!--]--></div><div class="block sm:flex gap-0 sm:gap-10 mt-14" data-v-6bdc5779=""><div class="w-full sm:w-1/4 text-left" data-v-6bdc5779=""><div data-v-6bdc5779=""><!----><div class="mb-7"><p class="font-general-medium text-2xl text-secondary-dark dark:text-secondary-light mb-2">About Project</p><ul class="leading-loose"><li class="font-general-regular text-ternary-dark dark:text-ternary-light"><a></a></li><!--[--><span><li class="font-general-regular text-ternary-dark dark:text-ternary-light"><span>Provider:&nbsp;</span><a href="https://www.coursera.org/" class="text-indigo-600 dark:text-indigo-300" target="_blank">Coursera.org</a></li></span><span><li class="font-general-regular text-ternary-dark dark:text-ternary-light"><span>Course:&nbsp;</span><a href="https://www.coursera.org/projects/sql-window-functions-for-analytics" class="text-indigo-600 dark:text-indigo-300" target="_blank">SQL Window Functions for Analytics</a></li></span><!--]--></ul></div><div class="mb-7"><p class="font-general-medium text-2xl text-ternary-dark dark:text-ternary-light mb-2">Objective</p><p class="font-general-regular text-primary-dark dark:text-ternary-light">This is a hands-on project that will help SQL users use window functions extensively for database insights. In this project, you will learn how to explore and query the project-db database extensively. We will start this hands-on project by retrieving the data in the table in the database.</p></div><div class="mb-7"><p class="font-general-medium text-2xl text-ternary-dark dark:text-ternary-light mb-2">Tools &amp; Technologies</p><p class="font-general-regular text-primary-dark dark:text-ternary-light">SQL, MySql Workbench, Data Analysis, Data Science</p></div><p class="font-general-medium text-2xl text-ternary-dark dark:text-ternary-light mb-2"> Share </p><div class="flex items-center gap-3 mt-5"><!--[--><a network="linkedin" target="_blank" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://solivervmazo.github.io/solivermazo/sql-window-functions-for-analytics&amp;source=solivervmazo.github.io%2Fsolivermazo"><!----></a><a network="facebook" target="_blank" href="https://www.facebook.com/sharer.php?u=http://solivervmazo.github.io/solivermazo/sql-window-functions-for-analytics"><!----></a><a network="twitter" target="_blank" href="https://twitter.com/intent/tweet?url=http://solivervmazo.github.io/solivermazo/sql-window-functions-for-analytics&amp;text=SQL Window Functions for Analytics"><!----></a><!--]--></div></div></div><div class="w-full sm:w-3/4 text-left mt-10 text-sm sm:mt-0 bg-slate-100 p-3 rounded-md overflow-auto max-h-screen" data-v-6bdc5779=""><!----><div class="markdown-body prose" data-v-6bdc5779=""><h3>Window function refresher</h3><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
	employee_id,
    first_name,
    department,
    hire_date,
    <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date) <span class="hljs-keyword">As</span> row_n
<span class="hljs-keyword">FROM</span>
	employees
</code></pre><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
	employee_id,
    first_name,
    department,
    hire_date,
    <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date) <span class="hljs-keyword">As</span> row_n
<span class="hljs-keyword">FROM</span>
	employees
</code></pre><h3>RANK() function</h3><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
	employee_id,
    first_name,
    department,
    hire_date,
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span>(
		<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>
	) <span class="hljs-keyword">As</span> rank_n
<span class="hljs-keyword">FROM</span>
	employees
</code></pre><ul><li><em>Retrieve the hire_date. Return details of employees hired on or before Dec, 2005 and are in First Aid, Movies, and Computers departments</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
    first_name,
    email,
    department,
    salary,
    hire_date,
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span>(
		<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>
	) <span class="hljs-keyword">As</span> rank_n
<span class="hljs-keyword">FROM</span>
	employees
<span class="hljs-keyword">WHERE</span>
    hire_date <span class="hljs-operator">&lt;=</span> <span class="hljs-string">'2005-12-31'</span> <span class="hljs-keyword">AND</span>
    department <span class="hljs-keyword">IN</span> (<span class="hljs-string">'First Aid'</span>, <span class="hljs-string">'Movies'</span>, <span class="hljs-string">'Computers'</span>)
</code></pre><ul><li><em>Return the fifth ranked salary for each department</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
	<span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> (
	<span class="hljs-keyword">SELECT</span> 
		first_name,
		email,
		department,
		salary,
		<span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span>(
			<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>
		) <span class="hljs-keyword">As</span> rank_n
	<span class="hljs-keyword">FROM</span>
		employees
) tbl
<span class="hljs-keyword">WHERE</span> rank_n <span class="hljs-operator">=</span> <span class="hljs-number">5</span>
</code></pre><h1>Undertand the difference between ROW_NUMBER, RANK AND DENSE_RANK</h1><ul><li><em>Create a common table expression to retrieve the customer_id,and how many times the customer has purchased from the mall</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">WITH</span> purchase_count <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        customer_id, 
        <span class="hljs-built_in">COUNT</span>(sales) <span class="hljs-keyword">AS</span> purchase
    <span class="hljs-keyword">FROM</span> 
        sales
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> customer_id
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> purchase <span class="hljs-keyword">DESC</span>
)

<span class="hljs-keyword">SELECT</span> 
    customer_id,
    purchase,
    <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> purchase <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> row_n,
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> purchase <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rank_n,
    <span class="hljs-built_in">DENSE_RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> purchase <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> dense_rank_n
<span class="hljs-keyword">FROM</span> 
    purchase_count
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> purchase <span class="hljs-keyword">DESC</span>;
</code></pre><h1>NTILE()</h1><ul><li><em>breaks/page the result set into groups</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
    first_name, 
    email, 
    department, 
    salary,
    <span class="hljs-built_in">NTILE</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) ntile_5
<span class="hljs-keyword">FROM</span> employees;

</code></pre><ul><li><em>Create a CTE that returns details of an employee and group the employees into five groups based on the order of their salaries</em></li><li><em>Find the average salary for each group of employees</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">WITH</span> salary_ranks <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        first_name,
        email, 
        department, 
        salary,
        <span class="hljs-built_in">NTILE</span>(<span class="hljs-number">5</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rank_of_salary
    <span class="hljs-keyword">FROM</span> employees
)

<span class="hljs-keyword">SELECT</span>
    rank_of_salary,
    ROUND(<span class="hljs-built_in">AVG</span>(salary), <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> avg_salary
<span class="hljs-keyword">FROM</span> salary_ranks
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> rank_of_salary
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> rank_of_salary
</code></pre><h1>Aggregate Window Functions</h1><ul><li><em>Retrieve the first names, department and number of employees working in that department</em></li></ul><pre class="hljs"><code><span class="hljs-comment">-- using subquery </span>
<span class="hljs-keyword">SELECT</span> 
    first_name, 
    department, 
    ( <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> dept_count <span class="hljs-keyword">FROM</span> employees e1 <span class="hljs-keyword">WHERE</span> e1.department <span class="hljs-operator">=</span> e2.department)
<span class="hljs-keyword">FROM</span> employees e2
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    department, 
    first_name
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> department;

<span class="hljs-comment">-- using window function</span>
<span class="hljs-keyword">SELECT</span> 
    first_name, 
    department,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">OVER</span>(
		<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department
        <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> department
    ) <span class="hljs-keyword">AS</span> department_count
<span class="hljs-keyword">FROM</span> employees 
</code></pre><ul><li><em>Total Salary for all employees</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
    first_name, 
    department,
    hire_date,
    <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">OVER</span>( <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hire_date ) <span class="hljs-keyword">AS</span> total_salary
<span class="hljs-keyword">FROM</span> employees 
</code></pre><ul><li><em>Total Salary for each department</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
    first_name, 
    department,
    hire_date,
    <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">OVER</span>( <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department ) <span class="hljs-keyword">AS</span> dept_total_salary
<span class="hljs-keyword">FROM</span> employees 
</code></pre><ul><li><em>Retrieve the first names, department and number of employees working in that department and in region</em></li></ul><pre class="hljs"><code><span class="hljs-keyword">SELECT</span> 
    first_name,
    department,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department) dept_count,
    region_id,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">OVER</span>(<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> region_id) region_count
<span class="hljs-keyword">FROM</span> employees
</code></pre><ul><li><em>Calculate the cumulative sum of customers purchase for the different ship mode</em></li></ul><pre class="hljs"><code><span class="hljs-comment">-- Create a common table expression to retrieve the customer_id, </span>
<span class="hljs-comment">-- ship_mode, and how many times the customer has purchased from the mall</span>
<span class="hljs-keyword">WITH</span> purchase_count <span class="hljs-keyword">AS</span> (
    <span class="hljs-keyword">SELECT</span> 
        customer_id, 
        ship_mode, 
        <span class="hljs-built_in">COUNT</span>(sales) <span class="hljs-keyword">AS</span> purchase
    <span class="hljs-keyword">FROM</span> sales
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> customer_id, ship_mode
    <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> purchase <span class="hljs-keyword">DESC</span>
)

<span class="hljs-keyword">SELECT</span> 
    customer_id, 
    ship_mode, 
    purchase,
    <span class="hljs-built_in">SUM</span>(purchase) <span class="hljs-keyword">OVER</span>( 
        <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> ship_mode 
        <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> customer_id <span class="hljs-keyword">ASC</span>
    ) <span class="hljs-keyword">AS</span> sum_of_sales
<span class="hljs-keyword">FROM</span> purchase_count
</code></pre><h1>Window frames</h1></div></div></div></div></div></div><div class="container mx-auto flex-none pt-5"><div class="pt-20 sm:pt-30 pb-8 mt-20 border-t-2 border-primary-light dark:border-secondary-dark"><div class="flex flex-col justify-center items-center mb-12 sm:mb-20"><p class="font-general-semibold text-3xl sm:text-4xl font-semibold text-primary-dark dark:text-primary-light mb-5"> Follow me </p><ul class="flex gap-4 sm:gap-8"><!--[--><a href="https://linkedin.com/in/solivervmazo" target="__blank" class="text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 cursor-pointer rounded-lg bg-gray-50 dark:bg-ternary-dark hover:bg-gray-100 shadow-sm p-4 duration-500"><!----></a><a href="https://github.com/solivervmazo" target="__blank" class="text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 cursor-pointer rounded-lg bg-gray-50 dark:bg-ternary-dark hover:bg-gray-100 shadow-sm p-4 duration-500"><!----></a><a href="https://www.kaggle.com/solivermazo" target="__blank" class="text-gray-400 hover:text-indigo-500 dark:hover:text-indigo-400 cursor-pointer rounded-lg bg-gray-50 dark:bg-ternary-dark hover:bg-gray-100 shadow-sm p-4 duration-500"><!----></a><!--]--></ul></div><div class="flex justify-center items-center text-center dark:bg-primary-dark"><div class="font-general-regular text-lg text-ternary-dark dark:text-ternary-light"> © 2023 &nbsp;-&nbsp; Soliver Mazo. </div></div></div></div></div></div></div>
    
  

</body></html>